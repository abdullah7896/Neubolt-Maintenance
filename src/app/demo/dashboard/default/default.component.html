<div class="row">
  <div class="col-md-12 col-xl-10">
    <h5 class="mb-3">Maintenance Complaints</h5>

    <!-- Alert Box -->
    <div *ngIf="alertMessage" class="alert alert-{{alertType}} alert-dismissible fade show" role="alert">
      {{ alertMessage }}
      <button type="button" class="btn-close" (click)="alertMessage=null"></button>
    </div>

    <div class="card tbl-card">
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead>
            <tr>
              <th>Complaint ID</th>
              <th>Complaint Name</th>
              <th>Status</th>
              <th>Driver</th>
              <th>EV ID</th>
              <th>Register Time</th>
              <th>Cnic No</th>
              <th>Driver No</th>
              <th>Status Updated</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let complaint of complaints">
              <td>{{ complaint.complaint_id }}</td>
              <td>{{ complaint.complaint_name }}</td>
              <td>
                <span class="badge"
                      [style.background-color]="
                        complaint.status === 'Pending' ? '#FFA500' :
                        complaint.status === 'In-Progress' ? '#17a2b8' :
                        complaint.status === 'Completed' ? '#28a745' :
                        complaint.status === 'Requested' ? '#6f42c1' : '#6c757d'
                      "
                      style="color: white;">
                  {{ complaint.status }}
                </span>
              </td>

              <td>
                <img [src]="getDriverImage(complaint.driver_image)" alt="Driver" width="60" height="60"
                     class="rounded-circle me-2">
                {{ complaint.driver_name }}
              </td>
              <td>{{ complaint.ev_id }}</td>
              <td>{{ complaint.complaint_register_time | date:'short' }}</td>
              <td>{{ complaint.driver_cnic }}</td>
              <td>{{ complaint.driver_number }}</td>
              <td>{{ complaint.status_change_time | date:'short' }}</td>

              <!-- Three-dot action image -->
              <td>
                <div class="position-relative">
                  <img src="assets/images/icons.png" 
                       alt="Actions" 
                       width="20" height="20"
                       style="cursor: pointer;"
                       (click)="toggleDropdown(complaint)">

                  <!-- Dropdown menu -->
                  <div class="dropdown-menu" 
                       [class.show]="dropdownOpenComplaintId === complaint.complaint_id"
                       style="position: absolute; top: 100%; right: 0; z-index: 1000;">
                    <div *ngFor="let s of actionStatuses" class="dropdown-item" 
                         (click)="updateStatusFromDropdown(complaint, s)">
                      Change Status to "{{ s }}"
                    </div>
                  </div>
                </div>
              </td>
            </tr>

            <tr *ngIf="!loading && complaints.length === 0">
              <td colspan="10" class="text-center">No complaints found.</td>
            </tr>
          </tbody>
        </table>

        <div *ngIf="loading" class="p-3 text-center">
          Loading complaints...
        </div>
      </div>
    </div>
  </div>
</div>
